@model FreeNest.Models.ViewModels.UserViewModel
@{
    ViewData["Title"] = "User Directory";
}

@section Styles {
    <style>
        body[data-theme="dark"] {
            background-color: #121212;
            color: #e0e0e0;
        }

            body[data-theme="dark"] .card {
                background-color: #1e1e1e;
                border: 1px solid #2c2c2c;
            }

            body[data-theme="dark"] .form-control {
                background-color: #2a2a2a;
                color: #fff;
                border: 1px solid #444;
            }

        .user-card {
            border-radius: 2rem;
            overflow: hidden;
            height: 100%;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            text-decoration: none;
            display: block;
            color: inherit;
            background: white;
        }

        body[data-theme="dark"] .user-card {
            background: #1e1e1e;
        }

        .user-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            text-decoration: none;
            color: inherit;
        }

        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #f0f0f0;
            margin: 0 auto;
            display: block;
        }

        body[data-theme="dark"] .avatar {
            border: 5px solid #333;
        }

        .avatar-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }

        .floating-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
        }

            .floating-toggle:hover {
                transform: scale(1.05);
                box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
            }
    </style>
}

@section Scripts {
    <script>
        // Search filtering
        document.getElementById('searchButton').addEventListener('click', filterUsers);
        document.getElementById('userSearch').addEventListener('keyup', filterUsers);

        function filterUsers() {
            const searchText = document.getElementById('userSearch').value.toLowerCase();
            const userCards = document.querySelectorAll('.user-card');

            userCards.forEach(card => {
                const name = card.querySelector('.user-name').textContent.toLowerCase();
                const username = card.querySelector('.user-username').textContent.toLowerCase();
                const email = card.querySelector('.user-email').textContent.toLowerCase();

                card.parentElement.style.display =
                    (name.includes(searchText) || username.includes(searchText) || email.includes(searchText))
                        ? "block" : "none";
            });
        }

        // Dark/Light mode toggle
        const toggleBtn = document.getElementById('themeToggle');
        toggleBtn.addEventListener('click', () => {
            const body = document.body;
            const currentTheme = body.getAttribute("data-theme");
            const newTheme = currentTheme === "dark" ? "light" : "dark";
            body.setAttribute("data-theme", newTheme);
            localStorage.setItem("theme", newTheme);
            toggleBtn.innerHTML = newTheme === "dark"
                ? '<i class="fas fa-sun"></i>'
                : '<i class="fas fa-moon"></i>';
        });

        // Load theme from localStorage
        window.onload = () => {
            const savedTheme = localStorage.getItem("theme") || "light";
            document.body.setAttribute("data-theme", savedTheme);
            toggleBtn.innerHTML = savedTheme === "dark"
                ? '<i class="fas fa-sun"></i>'
                : '<i class="fas fa-moon"></i>';
        };
    </script>
}

<div class="bg-primary text-white py-5 mb-5 text-center rounded-bottom-5 shadow-sm">
    <div class="container">
        <h1 class="display-5 fw-bold">User Directory</h1>
        <p class="lead">Explore and connect with our community</p>

        <div class="mx-auto" style="max-width: 500px;">
            <div class="input-group mt-4">
                <input type="text" class="form-control form-control-lg rounded-start-pill" placeholder="Search users..." id="userSearch">
                <button class="btn btn-light rounded-end-pill px-4" type="button" id="searchButton">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    @if (Model.Users != null && Model.Users.Any())
    {
        <div class="row">
            @foreach (var user in Model.Users)
            {
                <div class="col-md-4 mb-4">
                    <a href="/?username=@user.Username" class="user-card card shadow-lg border-0 text-center" target="_blank">
                        <div class="card-body">
                            @if (!string.IsNullOrEmpty(user.AvatarUrl))
                            {
                                <img src="/uploads/avatars/@user.AvatarUrl" class="avatar mb-3" alt="@user.Username">
                            }
                            else
                            {
                                <div class="avatar-placeholder mb-3">
                                    <i class="fas fa-user fa-2x"></i>
                                </div>
                            }

                            <h5 class="user-name fw-bold">@user.FullName</h5>
                            <p class="user-username text-muted mb-1">@@@user.Username</p>
                            <p class="user-email text-primary mb-3">@user.Email</p>

                            <div class="d-flex justify-content-center border-top pt-3">
                                <div>
                                    <div class="fw-bold fs-5">@(user.Links?.Count ?? 0)</div>
                                    <small class="text-muted">Links</small>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer fw-semibold text-white"
                             style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); border-radius: 0 0 2rem 2rem;">
                            Go to Profile
                        </div>
                    </a>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-users text-center py-5 bg-white rounded-5 shadow-sm" data-bs-theme="light">
            <i class="fas fa-users fs-1 text-muted mb-3"></i>
            <h3 class="text-muted">No users found</h3>
        </div>
    }
</div>

<!-- Floating Theme Toggle Button -->
<button id="themeToggle" class="floating-toggle">
    <i class="fas fa-moon"></i>
</button>
